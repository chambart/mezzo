open list

alias iterator_dup a (post: perm) = (duplicable a | iterator a empty post)

val new_iterator_dup [a] duplicable a => (consumes l: list a): iterator_dup a (l @ list a) =
  new_iterator l

val next_dup [a, post: perm]
  (consumes it: iterator_dup a post): either::either (x: a | it @ iterator_dup a post) (| post) =
  match next it with
  | Right ->
    right ()
  | Left { contents = x } ->
    assert (it @ iterator a empty post);
    left x
  end

val stop_dup [a, post: perm]
    (consumes it: iterator_dup a post): (| post) =
  stop it

