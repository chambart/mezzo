{"syntax":"<div class=\"highlight\"><pre><span class=\"n\">data</span> <span class=\"kt\">bool</span> <span class=\"o\">=</span> <span class=\"nc\">True</span> <span class=\"o\">|</span> <span class=\"nc\">False</span>\n<span class=\"n\">abstract</span> <span class=\"kt\">int</span>\n<span class=\"n\">fact</span> <span class=\"n\">duplicable</span> <span class=\"kt\">int</span>\n\n<span class=\"n\">exclusive</span> <span class=\"n\">data</span> <span class=\"n\">ref</span> <span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"nc\">Nil</span> <span class=\"o\">|</span> <span class=\"nc\">Ref</span> <span class=\"o\">{</span> <span class=\"n\">contents</span><span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"o\">}</span>\n\n<span class=\"c\">(* Cet exemple illustre un point un peu particulier. Ici, on obtient [y @ ref int] en sortie, mais</span>\n<span class=\"c\">   une autre possibilité aurait été de dire [y @ ref (=x)] qui est en fait une permission plus</span>\n<span class=\"c\">   précise que [y @ ref int]. Cependant, on ne peut pas en l&#39;état actuel des choses (il faudrait</span>\n<span class=\"c\">   implémenter une &quot;tactique&quot;) troquer [y @ ref (=x) ∗ x @ int] en [y @ ref int] sans test</span>\n<span class=\"c\">   dynamique. D&#39;ailleurs, ça n&#39;est pas toujours possible. Imaginons en effet le cas d&#39;une liste: [y</span>\n<span class=\"c\">   @ list (=x) ∗ x @ τ] ne se transforme pas en [y @ list τ], car si [τ] n&#39;est pas duplicable, il</span>\n<span class=\"c\">   faut un test dynamique pour vérifier que la liste a au plus un élément.</span>\n\n<span class=\"c\">  Un critère (correct ? peut-être...) est de dire : cette transformation est légale si le paramètre</span>\n<span class=\"c\">  du type n&#39;apparaît qu&#39;au plus une fois dans chaque branche et que le type n&#39;est pas récursif. Une</span>\n<span class=\"c\">  tactique serait alors envisageable...</span>\n\n<span class=\"c\">  Pour l&#39;instant, tout ça est trop compliqué, et il est plus important de permettre d&#39;annoter</span>\n<span class=\"c\">  l&#39;ensemble des permissions attendues.</span>\n<span class=\"c\">*)</span>\n<span class=\"k\">val</span> <span class=\"n\">v9</span> <span class=\"o\">=</span>\n  <span class=\"k\">let</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"mi\">3</span> <span class=\"k\">in</span>\n  <span class=\"k\">let</span> <span class=\"n\">y</span> <span class=\"o\">=</span>\n    <span class=\"k\">if</span> <span class=\"n\">explain</span> <span class=\"nc\">True</span> <span class=\"k\">then</span>\n      <span class=\"nc\">Nil</span>\n    <span class=\"k\">else</span>\n      <span class=\"nc\">Ref</span> <span class=\"o\">{</span> <span class=\"n\">contents</span> <span class=\"o\">=</span> <span class=\"n\">x</span> <span class=\"o\">}</span>\n  <span class=\"k\">in</span>\n  <span class=\"n\">y</span>\n</pre></div>\n","current_location":{"start":{"line":24,"col":9},"end":{"line":28,"col":26}},"file_name":"tests/merge9.hml","type":"merge","merged_env":{"svg":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 2.26.3 (20100126.1600)\n -->\n<!-- Title: g Pages: 1 -->\n<svg width=\"410pt\" height=\"60pt\"\n viewBox=\"0.00 0.00 410.00 60.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph1\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 56)\">\n<title>g</title>\n<polygon fill=\"white\" stroke=\"white\" points=\"-4,5 -4,-56 407,-56 407,5 -4,5\"/>\n<!-- node8 -->\n<g id=\"node8\" class=\"node\"><title>node8</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"-0.5,-8 -0.5,-44 58.5,-44 58.5,-8 -0.5,-8\"/>\n<text text-anchor=\"middle\" x=\"29\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">ref int</text>\n</g>\n<!-- node6 -->\n<g id=\"node6\" class=\"node\"><title>node6</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"76,-1 76,-51 158,-51 158,-1 76,-1\"/>\n<text text-anchor=\"middle\" x=\"117\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">unknown</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"76,-26 158,-26 \"/>\n<text text-anchor=\"middle\" x=\"117\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">y</text>\n</g>\n<!-- node5 -->\n<g id=\"node5\" class=\"node\"><title>node5</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"176,-1 176,-51 230,-51 230,-1 176,-1\"/>\n<text text-anchor=\"middle\" x=\"203\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">int</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"176,-26 230,-26 \"/>\n<text text-anchor=\"middle\" x=\"203\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">x</text>\n</g>\n<!-- node3 -->\n<g id=\"node3\" class=\"node\"><title>node3</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"248,-1 248,-51 330,-51 330,-1 248,-1\"/>\n<text text-anchor=\"middle\" x=\"289\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">unknown</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"248,-26 330,-26 \"/>\n<text text-anchor=\"middle\" x=\"289\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">v9</text>\n</g>\n<!-- node7 -->\n<g id=\"node7\" class=\"node\"><title>node7</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"348,-8 348,-44 402,-44 402,-8 348,-8\"/>\n<text text-anchor=\"middle\" x=\"375\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">True</text>\n</g>\n</g>\n</svg>\n","root":8,"points":{"7":{"names":[["auto","y_if"]],"locations":[{"start":{"line":25,"col":14},"end":{"line":25,"col":20}}],"kind":"term","permissions":["=y_if","True"]},"3":{"names":[["user","v9"]],"locations":[{"start":{"line":22,"col":4},"end":{"line":22,"col":7}}],"kind":"term","permissions":["=v9"]},"5":{"names":[["user","x"]],"locations":[{"start":{"line":23,"col":9},"end":{"line":23,"col":11}},{"start":{"line":23,"col":6},"end":{"line":23,"col":8}}],"kind":"term","permissions":["=x","int"]},"6":{"names":[["user","y"]],"locations":[{"start":{"line":24,"col":6},"end":{"line":24,"col":8}}],"kind":"term","permissions":["=y"]},"8":{"names":[["auto","merge_root5"]],"locations":[{"start":{"line":24,"col":9},"end":{"line":28,"col":26}}],"kind":"term","permissions":["=merge_root5","ref int"]}}},"sub_envs":[{"svg":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 2.26.3 (20100126.1600)\n -->\n<!-- Title: g Pages: 1 -->\n<svg width=\"406pt\" height=\"60pt\"\n viewBox=\"0.00 0.00 406.00 60.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph1\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 56)\">\n<title>g</title>\n<polygon fill=\"white\" stroke=\"white\" points=\"-4,5 -4,-56 403,-56 403,5 -4,5\"/>\n<!-- node8 -->\n<g id=\"node8\" class=\"node\"><title>node8</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"0,-8 0,-44 54,-44 54,-8 0,-8\"/>\n<text text-anchor=\"middle\" x=\"27\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">Nil</text>\n</g>\n<!-- node6 -->\n<g id=\"node6\" class=\"node\"><title>node6</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"72,-1 72,-51 154,-51 154,-1 72,-1\"/>\n<text text-anchor=\"middle\" x=\"113\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">unknown</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"72,-26 154,-26 \"/>\n<text text-anchor=\"middle\" x=\"113\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">y</text>\n</g>\n<!-- node5 -->\n<g id=\"node5\" class=\"node\"><title>node5</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"172,-1 172,-51 226,-51 226,-1 172,-1\"/>\n<text text-anchor=\"middle\" x=\"199\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">int</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"172,-26 226,-26 \"/>\n<text text-anchor=\"middle\" x=\"199\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">x</text>\n</g>\n<!-- node3 -->\n<g id=\"node3\" class=\"node\"><title>node3</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"244,-1 244,-51 326,-51 326,-1 244,-1\"/>\n<text text-anchor=\"middle\" x=\"285\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">unknown</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"244,-26 326,-26 \"/>\n<text text-anchor=\"middle\" x=\"285\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">v9</text>\n</g>\n<!-- node7 -->\n<g id=\"node7\" class=\"node\"><title>node7</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"344,-8 344,-44 398,-44 398,-8 344,-8\"/>\n<text text-anchor=\"middle\" x=\"371\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">True</text>\n</g>\n</g>\n</svg>\n","root":8,"points":{"7":{"names":[["auto","y_if"]],"locations":[{"start":{"line":25,"col":14},"end":{"line":25,"col":20}}],"kind":"term","permissions":["True","=y_if"]},"3":{"names":[["user","v9"]],"locations":[{"start":{"line":22,"col":4},"end":{"line":22,"col":7}}],"kind":"term","permissions":["=v9"]},"5":{"names":[["user","x"]],"locations":[{"start":{"line":23,"col":9},"end":{"line":23,"col":11}},{"start":{"line":23,"col":6},"end":{"line":23,"col":8}}],"kind":"term","permissions":["int","=x"]},"6":{"names":[["user","y"]],"locations":[{"start":{"line":24,"col":6},"end":{"line":24,"col":8}}],"kind":"term","permissions":["=y"]},"8":{"names":[["auto","y_then"]],"locations":[{"start":{"line":26,"col":6},"end":{"line":26,"col":9}}],"kind":"term","permissions":["Nil","=y_then"]}}},{"svg":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 2.26.3 (20100126.1600)\n -->\n<!-- Title: g Pages: 1 -->\n<svg width=\"394pt\" height=\"148pt\"\n viewBox=\"0.00 0.00 394.00 148.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph1\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 144)\">\n<title>g</title>\n<polygon fill=\"white\" stroke=\"white\" points=\"-4,5 -4,-144 391,-144 391,5 -4,5\"/>\n<!-- node8 -->\n<g id=\"node8\" class=\"node\"><title>node8</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"-0.5,-8 -0.5,-44 114.5,-44 114.5,-8 -0.5,-8\"/>\n<text text-anchor=\"middle\" x=\"18.5\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">Ref</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"37.5,-8 37.5,-44 \"/>\n<text text-anchor=\"middle\" x=\"76\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">contents</text>\n</g>\n<!-- node5 -->\n<g id=\"node5\" class=\"node\"><title>node5</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"49,-89 49,-139 103,-139 103,-89 49,-89\"/>\n<text text-anchor=\"middle\" x=\"76\" y=\"-122.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">int</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"49,-114 103,-114 \"/>\n<text text-anchor=\"middle\" x=\"76\" y=\"-97.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">x</text>\n</g>\n<!-- node8&#45;&gt;node5 -->\n<g id=\"edge2\" class=\"edge\"><title>node8:contents&#45;&gt;node5</title>\n<path fill=\"none\" stroke=\"black\" d=\"M76,-44C76,-55.2356 76,-67.4857 76,-78.552\"/>\n<polygon fill=\"black\" stroke=\"black\" points=\"72.5001,-78.7275 76,-88.7276 79.5001,-78.7276 72.5001,-78.7275\"/>\n</g>\n<!-- node6 -->\n<g id=\"node6\" class=\"node\"><title>node6</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"132,-1 132,-51 214,-51 214,-1 132,-1\"/>\n<text text-anchor=\"middle\" x=\"173\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">unknown</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"132,-26 214,-26 \"/>\n<text text-anchor=\"middle\" x=\"173\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">y</text>\n</g>\n<!-- node3 -->\n<g id=\"node3\" class=\"node\"><title>node3</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"232,-1 232,-51 314,-51 314,-1 232,-1\"/>\n<text text-anchor=\"middle\" x=\"273\" y=\"-34.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">unknown</text>\n<polyline fill=\"none\" stroke=\"black\" points=\"232,-26 314,-26 \"/>\n<text text-anchor=\"middle\" x=\"273\" y=\"-9.4\" font-family=\"Times Roman,serif\" font-size=\"14.00\">v9</text>\n</g>\n<!-- node7 -->\n<g id=\"node7\" class=\"node\"><title>node7</title>\n<polygon fill=\"none\" stroke=\"black\" points=\"332,-8 332,-44 386,-44 386,-8 332,-8\"/>\n<text text-anchor=\"middle\" x=\"359\" y=\"-21.9\" font-family=\"Times Roman,serif\" font-size=\"14.00\">True</text>\n</g>\n</g>\n</svg>\n","root":8,"points":{"7":{"names":[["auto","y_if"]],"locations":[{"start":{"line":25,"col":14},"end":{"line":25,"col":20}}],"kind":"term","permissions":["True","=y_if"]},"3":{"names":[["user","v9"]],"locations":[{"start":{"line":22,"col":4},"end":{"line":22,"col":7}}],"kind":"term","permissions":["=v9"]},"5":{"names":[["user","x"]],"locations":[{"start":{"line":23,"col":9},"end":{"line":23,"col":11}},{"start":{"line":23,"col":6},"end":{"line":23,"col":8}}],"kind":"term","permissions":["int","=x"]},"6":{"names":[["user","y"]],"locations":[{"start":{"line":24,"col":6},"end":{"line":24,"col":8}}],"kind":"term","permissions":["=y"]},"8":{"names":[["auto","y_else"]],"locations":[{"start":{"line":28,"col":6},"end":{"line":28,"col":26}}],"kind":"term","permissions":["Ref {\n    contents: =x\n  }","=y_else"]}}}]}