#!/bin/bash

# Check that ocamlfind is present as the Makefile assumes this
if [ ! which ocamlfind > /dev/null 2>&1 ]; then
  echo "Mezzo requires ocamlfind";
  exit 255
fi

libdir=$(pwd)
srcdir=$(pwd)
install=true
while : ; do
  case "$1" in
    "")
      break;;

    --local)
      install=false;;
  esac
  shift;
done

if $install ; then
  libdir=$(ocamlfind printconf destdir)/mezzo
fi

echo "(* This file is auto-generated by the configure script *)" > configure.ml
echo "# This file is auto-generated by the configure script" > Makefile.config

# Mezzo needs to know where the corelib and stdlib directories can be found
echo "let lib_dir = \"$libdir\";;" >> configure.ml
echo "let src_dir = \"$srcdir\";;" >> configure.ml

echo "LIBDIR = \"$libdir\"" >> Makefile.config
echo "SRCDIR = \"$srcdir\"" >> Makefile.config

echo "... configure done."
